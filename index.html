<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="记录点点滴滴">
<meta property="og:type" content="website">
<meta property="og:title" content="jefby的小窝">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="jefby的小窝">
<meta property="og:description" content="记录点点滴滴">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jefby的小窝">
<meta name="twitter:description" content="记录点点滴滴">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>jefby的小窝</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jefby的小窝</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/20/将mobilenet-ssd-tensorflow-pb转换为tflite的详细步骤/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/20/将mobilenet-ssd-tensorflow-pb转换为tflite的详细步骤/" itemprop="url">
                  将mobilenet_ssd tensorflow.pb转换为tflite的详细步骤
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-20 00:47:34 / 修改时间：13:41:06" itemprop="dateCreated datePublished" datetime="2018-08-20T00:47:34+08:00">2018-08-20</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/20/将mobilenet-ssd-tensorflow-pb转换为tflite的详细步骤/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/20/将mobilenet-ssd-tensorflow-pb转换为tflite的详细步骤/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-依赖工具及环境"><a href="#1-依赖工具及环境" class="headerlink" title="1.依赖工具及环境"></a>1.依赖工具及环境</h3><ul>
<li><p>下载tensorflow-models源码</p>
<p>  <code>git clone https://github.com/tensorflow/models</code></p>
</li>
<li><p>按照提示配置环境<br>  注意在~/.bashrc添加上</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># From tensorflow/models/research/</span><br><span class="line">export PYTHONPATH=$PYTHONPATH:xxxxxx/tensorflow-models/research:xxxx/tensorflow-models/research/slim</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>下载tensorflow源码</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/tensorflow/tensorflow</span><br><span class="line">cd tensorflow</span><br><span class="line">git checkout r1.10</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-设置变量"><a href="#2-设置变量" class="headerlink" title="2.设置变量"></a>2.设置变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ROOT_PATH=xxxxx/tensorflow/pretrained_models</span><br><span class="line">export CONFIG_FILE=$&#123;ROOT_PATH&#125;/pipeline.config</span><br><span class="line">export CHECKPOINT_PATH=$&#123;ROOT_PATH&#125;/model.ckpt</span><br><span class="line">export OUTPUT_DIR=/tmp/tflite</span><br></pre></td></tr></table></figure>
<h3 id="根据pb、checkpoint、pipeline-config等生成frozen-graph"><a href="#根据pb、checkpoint、pipeline-config等生成frozen-graph" class="headerlink" title="根据pb、checkpoint、pipeline.config等生成frozen graph"></a>根据pb、checkpoint、pipeline.config等生成frozen graph</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/export_tflite_ssd_graph.py --pipeline_config_path $CONFIG_FILE  --trained_checkpoint_prefix $CHECKPOINT_PATH --output_directory /tmp/tflite/ --add_postprocessing_op=true</span><br></pre></td></tr></table></figure>
<h3 id="3-通过TOCO获取优化后的模型"><a href="#3-通过TOCO获取优化后的模型" class="headerlink" title="3.通过TOCO获取优化后的模型"></a>3.通过TOCO获取优化后的模型</h3><pre><code>TOCO: TensorFlow Lite Optimizing Converter
</code></pre><h4 id="3-1）如果想要整型-这块暂时没调通"><a href="#3-1）如果想要整型-这块暂时没调通" class="headerlink" title="3.1）如果想要整型[这块暂时没调通]"></a>3.1）如果想要整型[这块暂时没调通]</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bazel run --config=opt tensorflow/contrib/lite/toco:toco -- \</span><br><span class="line">--input_file=$OUTPUT_DIR/tflite_graph.pb \</span><br><span class="line">--output_file=$OUTPUT_DIR/detect.tflite \</span><br><span class="line">--input_shapes=1,300,300,3 \</span><br><span class="line">--input_arrays=normalized_input_image_tensor \</span><br><span class="line">--output_arrays=&apos;TFLite_Detection_PostProcess&apos;,&apos;TFLite_Detection_PostProcess:1&apos;,&apos;TFLite_Detection_PostProcess:2&apos;,&apos;TFLite_Detection_PostProcess:3&apos; \</span><br><span class="line">--inference_type=QUANTIZED_UINT8 \</span><br><span class="line">--mean_values=128 \</span><br><span class="line">--std_values=128 \</span><br><span class="line">--change_concat_input_ranges=false \</span><br><span class="line">--allow_custom_ops</span><br></pre></td></tr></table></figure>
<h4 id="3-2）如果想要浮点类型"><a href="#3-2）如果想要浮点类型" class="headerlink" title="3.2）如果想要浮点类型"></a>3.2）如果想要浮点类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bazel run --config=opt tensorflow/contrib/lite/toco:toco -- \</span><br><span class="line">--input_file=$OUTPUT_DIR/tflite_graph.pb \</span><br><span class="line">--output_file=$OUTPUT_DIR/detect.tflite \</span><br><span class="line">--input_shapes=1,300,300,3 \</span><br><span class="line">--input_arrays=normalized_input_image_tensor \</span><br><span class="line">--output_arrays=&apos;TFLite_Detection_PostProcess&apos;,&apos;TFLite_Detection_PostProcess:1&apos;,&apos;TFLite_Detection_PostProcess:2&apos;,&apos;TFLite_Detection_PostProcess:3&apos;  \</span><br><span class="line">--inference_type=FLOAT \</span><br><span class="line">--allow_custom_ops</span><br></pre></td></tr></table></figure>
<h3 id="4-集成到Android-Studio工程中"><a href="#4-集成到Android-Studio工程中" class="headerlink" title="4. 集成到Android Studio工程中"></a>4. 集成到Android Studio工程中</h3><h4 id="4-1）更新模型和配置文件"><a href="#4-1）更新模型和配置文件" class="headerlink" title="4.1）更新模型和配置文件"></a>4.1）更新模型和配置文件</h4><pre><code>`cp /tmp/tflite/detect.tflite tensorflow/contrib/lite/examples/android/app/src/main/assets`
</code></pre><p>编辑tensorflow/contrib/lite/examples/android/BUILD，增加新的detect.tflite和color_pen_label.txt</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@@ -37,9 +37,10 @@ android_binary(</span><br><span class="line">         "@tflite_conv_actions_frozen//:conv_actions_frozen.tflite",</span><br><span class="line">         "//tensorflow/contrib/lite/examples/android/app/src/main/assets:conv_actions_labels.txt",</span><br><span class="line">         "@tflite_mobilenet_ssd//:mobilenet_ssd.tflite",</span><br><span class="line"><span class="deletion">-        "@tflite_mobilenet_ssd_quant//:detect.tflite",</span></span><br><span class="line"><span class="addition">+        "//tensorflow/contrib/lite/examples/android/app/src/main/assets:detect.tflite",</span></span><br><span class="line">         "//tensorflow/contrib/lite/examples/android/app/src/main/assets:box_priors.txt",</span><br><span class="line">         "//tensorflow/contrib/lite/examples/android/app/src/main/assets:coco_labels_list.txt",</span><br><span class="line"><span class="addition">+        "//tensorflow/contrib/lite/examples/android/app/src/main/assets:color_pen_label.txt",</span></span><br><span class="line">     ],</span><br></pre></td></tr></table></figure>
<p>新建color_pen_label.txt内容为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">???</span><br><span class="line">color-pen</span><br></pre></td></tr></table></figure>
<p>拷贝到demo/asset目录：</p>
<p><code>cp color_pen_label.txt tensorflow/contrib/lite/examples/android/app/src/main/assets</code></p>
<p>如果是float的话，按如下修改源码<br>tensorflow/contrib/lite/examples/android/app/src/main/java/org/tensorflow/demo/DetectorActivity.java</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@@ -50,9 +50,9 @@ public class DetectorActivity extends CameraActivity implements OnImageAvailable</span><br><span class="line"></span><br><span class="line">   // Configuration values for the prepackaged SSD model.</span><br><span class="line">   private static final int TF_OD_API_INPUT_SIZE = 300;</span><br><span class="line"><span class="deletion">-  private static final boolean TF_OD_API_IS_QUANTIZED = true;</span></span><br><span class="line"><span class="addition">+  private static final boolean TF_OD_API_IS_QUANTIZED = false;</span></span><br><span class="line">   private static final String TF_OD_API_MODEL_FILE = "detect.tflite";</span><br><span class="line"><span class="deletion">-  private static final String TF_OD_API_LABELS_FILE = "file:///android_asset/coco_labels_list.txt";</span></span><br><span class="line"><span class="addition">+  private static final String TF_OD_API_LABELS_FILE = "file:///android_asset/color_pen_label.txt";</span></span><br></pre></td></tr></table></figure>
<p>如果是量化模型的话，按如下修改源码</p>
<p>@@ -50,9 +50,9 @@ public class DetectorActivity extends CameraActivity implements OnImageAvailable</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   // Configuration values for the prepackaged SSD model.</span><br><span class="line">   private static final int TF_OD_API_INPUT_SIZE = 300;</span><br><span class="line">   private static final String TF_OD_API_MODEL_FILE = &quot;detect.tflite&quot;;</span><br><span class="line">-  private static final String TF_OD_API_LABELS_FILE = &quot;file:///android_asset/coco_labels_list.txt&quot;;</span><br><span class="line">+  private static final String TF_OD_API_LABELS_FILE = &quot;file:///android_asset/color_pen_label.txt&quot;;</span><br></pre></td></tr></table></figure>
<h4 id="4-2）编译tflite-demo-app"><a href="#4-2）编译tflite-demo-app" class="headerlink" title="4.2）编译tflite_demo app"></a>4.2）编译tflite_demo app</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bazel build --cxxopt=--std=c++11 //tensorflow/contrib/lite/examples/android:tflite_demo</span><br><span class="line"></span><br><span class="line"># arm64版本</span><br><span class="line">bazel build -c opt --config=android_arm64 --cxxopt=&apos;--std=c++11&apos; //tensorflow/contrib/lite/examples/android:tflite_demo</span><br></pre></td></tr></table></figure>
<h4 id="4-3）安装到Android设备"><a href="#4-3）安装到Android设备" class="headerlink" title="4.3）安装到Android设备"></a>4.3）安装到Android设备</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install -r bazel-bin/tensorflow/contrib/lite/examples/android/tflite_demo.apk</span><br></pre></td></tr></table></figure>
<h4 id="4-4）运行TFL-Detect-App"><a href="#4-4）运行TFL-Detect-App" class="headerlink" title="4.4）运行TFL Detect App"></a>4.4）运行TFL Detect App</h4>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/19/AArch64硬件平台整理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/19/AArch64硬件平台整理/" itemprop="url">
                  AArch64硬件平台整理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-19 21:06:40" itemprop="dateCreated datePublished" datetime="2018-08-19T21:06:40+08:00">2018-08-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/19/AArch64硬件平台整理/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/19/AArch64硬件平台整理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ARM发布ARM v8架构，主要针对高性能企业级市场，由于ARM系列芯片的高度可定制和低功耗特性，众多小伙伴看到了服务器市场的希望，纷纷跟上，积极推进ARM进军传统服务器领域，虽然目前跟Intel相比还是太弱，但我相信肯定会打出一片天地，ARM授权SoC IP核心，企业可以根据具体应用需求来定制芯片，另外可以加入特定的硬件逻辑，例如SSL安全验证等，这些都是Intel所不能比得，就是生态系统目前还未完全建立，需要各个厂商的通力协作。现整理部分AArch64硬件平台，以方便自己和需要的人做参考，有新的设备欢迎提醒哈！</p>
<h4 id="1-versatile-express（FPGA-soft-core）"><a href="#1-versatile-express（FPGA-soft-core）" class="headerlink" title="1. versatile-express（FPGA soft-core）"></a>1. versatile-express（FPGA soft-core）</h4><p>ARM公司推出的示范平台，用于验证</p>
<h4 id="2-Applied-Micro-Mustang"><a href="#2-Applied-Micro-Mustang" class="headerlink" title="2. Applied Micro Mustang:"></a>2. Applied Micro Mustang:</h4><p>8核ArmV8架构，最早的arm64硬件平台，目前已经可以安装Linaro Ubuntu、Fedora、OpenSUSE等系统，软件支持做的比较好，bootloader也替换为UEFI，而非嵌入式常用的uboot。<br><a href="https://www.apm.com/products/data-center/x-gene-family/x-c1-development-kits/" target="_blank" rel="noopener">https://www.apm.com/products/data-center/x-gene-family/x-c1-development-kits/</a></p>
<h4 id="3-ARM-Juno"><a href="#3-ARM-Juno" class="headerlink" title="3. ARM Juno"></a>3. ARM Juno</h4><p><a href="http://www.arm.com/zh/products/tools/development-boards/versatile-express/juno-arm-development-platform.php" target="_blank" rel="noopener">http://www.arm.com/zh/products/tools/development-boards/versatile-express/juno-arm-development-platform.php</a></p>
<h4 id="4-Qemu"><a href="#4-Qemu" class="headerlink" title="4. Qemu"></a>4. Qemu</h4><p>软件模拟硬件平台，<a href="http://www.bennee.com/~alex/blog/2014/05/09/running-linux-in-qemus-aarch64-system-emulation-mode/" target="_blank" rel="noopener">http://www.bennee.com/~alex/blog/2014/05/09/running-linux-in-qemus-aarch64-system-emulation-mode/</a></p>
<h4 id="5-AMD-64-bit-ARM-Opteron-Developer-Kit"><a href="#5-AMD-64-bit-ARM-Opteron-Developer-Kit" class="headerlink" title="5. AMD 64-bit ARM Opteron Developer Kit"></a>5. AMD 64-bit ARM Opteron Developer Kit</h4><p>AMD的ARM64服务器平台</p>
<h4 id="6-Cavium-Project-ThunderX-48核心-amp-amp-EZchip"><a href="#6-Cavium-Project-ThunderX-48核心-amp-amp-EZchip" class="headerlink" title="6. Cavium Project ThunderX:(48核心) &amp;&amp; EZchip"></a>6. Cavium Project ThunderX:(48核心) &amp;&amp; EZchip</h4><p>战斗机，<a href="https://www.youtube.com/watch?v=zmnjZUQPq5U" target="_blank" rel="noopener">https://www.youtube.com/watch?v=zmnjZUQPq5U</a><br>100个ARM 64核心，详细资料可查看网址<a href="http://www.ezchip.com/products/?ezchip=585&amp;spage=686" target="_blank" rel="noopener">http://www.ezchip.com/products/?ezchip=585&amp;spage=686</a></p>
<h4 id="7-96Board"><a href="#7-96Board" class="headerlink" title="7. 96Board"></a>7. 96Board</h4><p>(1)HiKey : 8核心Cortex-A53，华为麒麟6220,<br><a href="https://www.96boards.org/products/hikey/" target="_blank" rel="noopener">https://www.96boards.org/products/hikey/</a><br>(2)DragonBoard410c，4核心Cortex-A53<br><a href="https://www.96boards.org/products/dragonboard/" target="_blank" rel="noopener">https://www.96boards.org/products/dragonboard/</a><br>(3)听说AMD也会推出一款面向企业级别的参考设计版，但是价格相对低廉些~</p>
<h4 id="8-华为平台"><a href="#8-华为平台" class="headerlink" title="8. 华为平台"></a>8. 华为平台</h4><p>D-01和D-02，产品不错，技术领先<br><a href="https://www.youtube.com/watch?v=dLHhnLLw4Fw" target="_blank" rel="noopener">https://www.youtube.com/watch?v=dLHhnLLw4Fw</a></p>
<h4 id="9-Nvidia-平台"><a href="#9-Nvidia-平台" class="headerlink" title="9. Nvidia 平台"></a>9. Nvidia 平台</h4><p>面向机器识别、人工智能和无人机图形处理运算方面的<br><a href="http://devblogs.nvidia.com/parallelforall/nvidia-jetson-tx1-supercomputer-on-module-drives-next-wave-of-autonomous-machines/" target="_blank" rel="noopener">http://devblogs.nvidia.com/parallelforall/nvidia-jetson-tx1-supercomputer-on-module-drives-next-wave-of-autonomous-machines/</a></p>
<p>购买链接：<br><a href="http://www.nvidia.com/object/jetson-tx1-dev-kit.html" target="_blank" rel="noopener">http://www.nvidia.com/object/jetson-tx1-dev-kit.html</a><br>最新版是TX2，有cuda加速，但CPU架构感觉有点老，怎么还是cortex-a57?：<br><a href="https://developer.nvidia.com/embedded/buy/jetson-tx2" target="_blank" rel="noopener">https://developer.nvidia.com/embedded/buy/jetson-tx2</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/19/PC创建并使用aarch64虚拟机/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/19/PC创建并使用aarch64虚拟机/" itemprop="url">
                  PC创建并使用aarch64虚拟机
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-19 14:32:42" itemprop="dateCreated datePublished" datetime="2018-08-19T14:32:42+08:00">2018-08-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/19/PC创建并使用aarch64虚拟机/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/19/PC创建并使用aarch64虚拟机/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>如果不想从头自己做虚拟机，可使用这个镜像<br>链接: <a href="https://pan.baidu.com/s/1aQikk7nZWlvXn2EZIn_M3w" target="_blank" rel="noopener">https://pan.baidu.com/s/1aQikk7nZWlvXn2EZIn_M3w</a> 密码: 2123<br>使用方法：<br>参考第4步，直接启动就可以，用户名和密码都是jefby</strong></p>
<hr>
<p>大部分人电脑都是x86_64，但有时候我们需要开发运行在arm64设备的程序，这时候arm64虚拟机就非常有用了，如下是详细步骤</p>
<h4 id="qemu-system-arm"><a href="#qemu-system-arm" class="headerlink" title="qemu-system-arm"></a>qemu-system-arm</h4><p>直接用apt安装 <code>sudo apt install -y qemu-system-arm</code><br>或者是从源码安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.qemu.org/qemu-2.12.1.tar.bz2</span><br><span class="line">tar -xjvf qemu-2.12.1.tar.bz2</span><br><span class="line">cd qemu-2.12.1/</span><br><span class="line">./configure –-target-list=aarch64-softmmu</span><br><span class="line">make -j16</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></p>
<p>源码安装需要注意，创建/etc/qemu-ifup文件，内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh </span><br><span class="line">/sbin/ifconfig $1 192.168.0.1</span><br></pre></td></tr></table></figure></p>
<p>完成后增加执行权限<br><code>chmod +x /etc/qemu-ifup</code></p>
<h4 id="下载ubuntuarm64-iso"><a href="#下载ubuntuarm64-iso" class="headerlink" title="下载ubuntuarm64.iso"></a>下载ubuntuarm64.iso</h4><p><a href="http://cdimage.ubuntu.com/releases/16.04/release/" target="_blank" rel="noopener">http://cdimage.ubuntu.com/releases/16.04/release/</a></p>
<p>创建40G大小的镜像，格式为qcow2，相比raw有个优势，比如同样创建40G的镜像，qcow2格式的size是真正使用的size而不是40G</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-img create -f qcow2  ubuntu16.04-arm64.qcow2 40G</span><br></pre></td></tr></table></figure>
<p><a href="https://imgchr.com/i/Pfv3h8" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/19/Pfv3h8.md.png" alt="Pfv3h8.md.png"></a></p>
<h4 id="创建虚拟机ubuntu16-04-arm64-qcow2并安装ubuntu16-04-5系统"><a href="#创建虚拟机ubuntu16-04-arm64-qcow2并安装ubuntu16-04-5系统" class="headerlink" title="创建虚拟机ubuntu16.04-arm64.qcow2并安装ubuntu16.04.5系统"></a>创建虚拟机ubuntu16.04-arm64.qcow2并安装ubuntu16.04.5系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-aarch64 -m 2048-cpu cortex-a57 -smp 2 -M virt -bios QEMU_EFI.fd -nographic -drive if=none,file=ubuntu-16.04.5-server-arm64.iso,id=cdrom,media=cdrom -device virtio-scsi-device -device scsi-cd,drive=cdrom -drive if=none,file=ubuntu16.04-arm64.qcow2,id=hd0 -device virtio-blk-device,drive=hd0</span><br></pre></td></tr></table></figure>
<p><img src="https://s1.ax1x.com/2018/08/19/PfvM7t.png" alt="PfvM7t.png"><br><strong>注意选择OpenSSH Server</strong><br>理论上如果顺利的话会自动出现登录界面，进入后如下<br><a href="https://imgchr.com/i/PfvlAP" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/19/PfvlAP.md.png" alt="PfvlAP.md.png"></a></p>
<h4 id="关机后重新启动命令"><a href="#关机后重新启动命令" class="headerlink" title="关机后重新启动命令"></a>关机后重新启动命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-aarch64 -m 2048 -cpu cortex-a57 -smp 2 -M virt -bios QEMU_EFI.fd -nographic -device virtio-scsi-device -drive if=none,file=ubuntu16.04-arm64.qcow2,id=hd0 -device virtio-blk-device,drive=hd0  -netdev type=tap,id=net0 -device virtio-net-device,netdev=net0</span><br></pre></td></tr></table></figure>
<h4 id="关于UEFI启动后第一项无法自动进入ubuntu解决方法"><a href="#关于UEFI启动后第一项无法自动进入ubuntu解决方法" class="headerlink" title="关于UEFI启动后第一项无法自动进入ubuntu解决方法"></a>关于UEFI启动后第一项无法自动进入ubuntu解决方法</h4><p>进入UEFI 界面，在uefi shell中输入exit后在Boot Maintenance Manager进入Boot Options，选择Add Boot Option 依次选择boot/efi/ubuntu/grubaa64.efi，并设置boot order，将添加的boot option放在第一个<br><a href="https://imgchr.com/i/PfvcjJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/19/PfvcjJ.md.png" alt="PfvcjJ.md.png"></a><br><a href="https://imgchr.com/i/Pfv2u9" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/19/Pfv2u9.md.png" alt="Pfv2u9.md.png"></a></p>
<h4 id="设置网络"><a href="#设置网络" class="headerlink" title="设置网络"></a>设置网络</h4><p>Host:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ifconfig tun0 192.168.0.1</span><br></pre></td></tr></table></figure>
<p>Virtual machine:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ifconfig eth0 up</span><br><span class="line">sudo ifconfig eth0 192.168.0.2</span><br></pre></td></tr></table></figure>
<h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><p>在主机端ssh <a href="mailto:user-name@192.168.0.2" target="_blank" rel="noopener">user-name@192.168.0.2</a>输入密码即可登录</p>
<h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h4><p><a href="https://blog.csdn.net/chenxiangneu/article/details/78955462" target="_blank" rel="noopener">https://blog.csdn.net/chenxiangneu/article/details/78955462</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/在aarch64中使用Qemu设置网络/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/07/在aarch64中使用Qemu设置网络/" itemprop="url">
                  在aarch64主机中使用qemu设置网络
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-12-07 01:03:53" itemprop="dateCreated datePublished" datetime="2016-12-07T01:03:53+08:00">2016-12-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/07/在aarch64中使用Qemu设置网络/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/12/07/在aarch64中使用Qemu设置网络/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在上一篇文章《在aarch64主机中使用qemu启动虚机》，介绍了如何使用用户网络模式来启动虚拟机，但是这种模式有很多缺点，例如不能和其他虚机通信，不能使用ping测试通信等。所以在这篇中讲述如何使用tap模式来启动虚机。</p>
<p>该模型为私有虚拟局域网模型，只允许在本host机器上访问，不会影响到host机器网络.<br><img src="https://wiki.libvirt.org/images/d/d4/Host_with_a_virtual_network_switch_in_nat_mode_and_two_guests.png" alt="tap网络"></p>
<h4 id="1-安装libvirt-daemon"><a href="#1-安装libvirt-daemon" class="headerlink" title="1. 安装libvirt daemon"></a>1. 安装libvirt daemon</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libvirt-daemon</span><br></pre></td></tr></table></figure>
<h4 id="2-启动libvirtd"><a href="#2-启动libvirtd" class="headerlink" title="2. 启动libvirtd"></a>2. 启动libvirtd</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service libvirtd start</span><br></pre></td></tr></table></figure>
<h4 id="3-使用新脚本启动镜像"><a href="#3-使用新脚本启动镜像" class="headerlink" title="3. 使用新脚本启动镜像"></a>3. 使用新脚本启动镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">if [ $# -ne 1 ];then</span><br><span class="line">  echo &quot;Usage: $0 network-mode[user|tap]&quot;</span><br><span class="line">  echo &quot;e.g.: $0 user&quot;</span><br><span class="line">  echo &quot;      $0 tap&quot;</span><br><span class="line">  exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ $1 == &quot;user&quot; ];then</span><br><span class="line">  # User Networking Mode</span><br><span class="line">  qemu-system-aarch64 -smp 4 -m 8092 -M virt -bios QEMU_EFI.fd -nographic \</span><br><span class="line">       -device virtio-blk-device,drive=image \</span><br><span class="line">       -drive if=none,id=image,file=xenial-server-cloudimg-arm64-uefi1.qcow2,format=qcow2 \</span><br><span class="line">       -device virtio-blk-device,drive=cloud \</span><br><span class="line">       -drive if=none,id=cloud,file=cloud.img,format=raw \</span><br><span class="line">       -netdev user,id=user0,hostfwd=tcp::2222-:22 -device virtio-net-device,netdev=user0 \</span><br><span class="line">       -enable-kvm -cpu host</span><br><span class="line">elif [ $1 == &quot;tap&quot; ];then</span><br><span class="line">  # Tap Networking Mode [Private Virtual Network]</span><br><span class="line">  macaddress=52:54:00:4a:1e:d4</span><br><span class="line">  qemu-system-aarch64 -smp 4 -m 8092 -M virt -bios QEMU_EFI.fd -nographic \</span><br><span class="line">       -device virtio-blk-device,drive=image \</span><br><span class="line">       -drive if=none,id=image,file=xenial-server-cloudimg-arm64-uefi1.qcow2,format=qcow2 \</span><br><span class="line">       -device virtio-blk-device,drive=cloud \</span><br><span class="line">       -drive if=none,id=cloud,file=cloud.img,format=raw \</span><br><span class="line">       -device virtio-net-device,netdev=network0,mac=$macaddress \</span><br><span class="line">       -netdev tap,id=network0,ifname=tap0,script=qemu-ifup.sh,downscript=no  \</span><br><span class="line">       -enable-kvm -cpu host</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>依赖的qemu-ifup.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">set -x</span><br><span class="line"></span><br><span class="line">switch=virbr0</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$1&quot; ];then</span><br><span class="line">        # tunctl -u `whoami` -t $1 (use ip tuntap instead!)</span><br><span class="line">        ip tuntap add $1 mode tap user `whoami`</span><br><span class="line">        ip link set $1 up</span><br><span class="line">        sleep 0.5s</span><br><span class="line">        # brctl addif $switch $1 (use ip link instead!)</span><br><span class="line">        ip link set $1 master $switch</span><br><span class="line">        exit 0</span><br><span class="line">else</span><br><span class="line">        echo &quot;Error: no interface specified&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<p><code>./start_vm.sh tap</code></p>
<h4 id="4-查看ip"><a href="#4-查看ip" class="headerlink" title="4. 查看ip"></a>4. 查看ip</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh net-dhcp-leases default</span><br></pre></td></tr></table></figure>
<p>结果如下图：</p>
<p><a href="https://imgchr.com/i/Ph8QQU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/19/Ph8QQU.md.png" alt="Ph8QQU.md.png"></a></p>
<p>然后使用ssh登录即可</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/25/在aarch64中使用Qemu启动虚拟机/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/25/在aarch64中使用Qemu启动虚拟机/" itemprop="url">
                  在aarch64主机中使用Qemu启动虚拟机
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-11-25 20:35:19" itemprop="dateCreated datePublished" datetime="2016-11-25T20:35:19+08:00">2016-11-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/25/在aarch64中使用Qemu启动虚拟机/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/11/25/在aarch64中使用Qemu启动虚拟机/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-host"><a href="#1-host" class="headerlink" title="1. host"></a>1. host</h3><p>CentOS Linux release 7.2.1603 (AltArch) aarch64<br>kernel: 3.19.0-0.79.aa7a.aarch64</p>
<p><strong>检查内核是否支持kvm</strong></p>
<blockquote>
<p>$dmesg | grep -i kvm<br>[    0.364920] kvm [1]: GICH base=0x780c0000, GICV base=0x780e0000, IRQ=122<br>[    0.365026] kvm [1]: timer IRQ3<br>[    0.365039] kvm [1]: Hyp mode initialized successfully</p>
</blockquote>
<h3 id="2-安装必须的包"><a href="#2-安装必须的包" class="headerlink" title="2. 安装必须的包"></a>2. 安装必须的包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y qemu-system-aarch64</span><br></pre></td></tr></table></figure>
<h3 id="3-下载uefi-img和QEMU-EFI-fd"><a href="#3-下载uefi-img和QEMU-EFI-fd" class="headerlink" title="3. 下载uefi.img和QEMU_EFI.fd"></a>3. 下载uefi.img和QEMU_EFI.fd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://releases.linaro.org/components/kernel/uefi-linaro/15.12/release/qemu64/QEMU_EFI.fd</span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/xenial/20161124/xenial-server-cloudimg-arm64-uefi1.img</span><br></pre></td></tr></table></figure>
<h3 id="4-制作cloud-img"><a href="#4-制作cloud-img" class="headerlink" title="4. 制作cloud.img"></a>4. 制作cloud.img</h3><ul>
<li>创建cloud.txt文件，内容如下，其中ssh-rsa换做你本地的id_rsa.pub</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#cloud-config</span><br><span class="line"> </span><br><span class="line">users:</span><br><span class="line">  - name: &lt;your_username&gt;</span><br><span class="line">    ssh-authorized-keys:</span><br><span class="line">      - ssh-rsa AAAAB3NzaC1y....</span><br><span class="line">    sudo: [&apos;ALL=(ALL) NOPASSWD:ALL&apos;]</span><br><span class="line">    groups: sudo</span><br><span class="line">    shell: /bin/bash</span><br></pre></td></tr></table></figure>
<ul>
<li>创建cloud.img</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 根据cloud.txt内容创建镜像cloud.img</span><br><span class="line">$cloud-localds cloud.img cloud.txt</span><br></pre></td></tr></table></figure>
<h3 id="5-启动镜像"><a href="#5-启动镜像" class="headerlink" title="5. 启动镜像"></a>5. 启动镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-aarch64 -smp 4 -m 8092 -M virt -bios QEMU_EFI.fd -nographic \</span><br><span class="line">       -device virtio-blk-device,drive=image \</span><br><span class="line">       -drive if=none,id=image,file=xenial-server-cloudimg-arm64-uefi1.img \</span><br><span class="line">       -device virtio-blk-device,drive=cloud \</span><br><span class="line">       -drive if=none,id=cloud,file=cloud.img \</span><br><span class="line">       -netdev user,id=user0,hostfwd=tcp::2222-:22 -device virtio-net-device,netdev=user0 \</span><br><span class="line">       -enable-kvm -cpu host</span><br></pre></td></tr></table></figure>
<h3 id="6-登录"><a href="#6-登录" class="headerlink" title="6. 登录"></a>6. 登录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 2222 &lt;your_username&gt;@localhost</span><br></pre></td></tr></table></figure>
<p>成功后如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@APM html]# ssh -p 2222 root@localhost</span><br><span class="line">Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-47-generic aarch64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  Get cloud support with Ubuntu Advantage Cloud Guest:</span><br><span class="line">    http://www.ubuntu.com/business/services/cloud</span><br><span class="line"></span><br><span class="line">0 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Fri Nov 25 12:22:42 2016 from 10.0.2.2</span><br><span class="line">root@ubuntu:~# cat /etc/os-release</span><br><span class="line">NAME=&quot;Ubuntu&quot;</span><br><span class="line">VERSION=&quot;16.04.1 LTS (Xenial Xerus)&quot;</span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">PRETTY_NAME=&quot;Ubuntu 16.04.1 LTS&quot;</span><br><span class="line">VERSION_ID=&quot;16.04&quot;</span><br><span class="line">HOME_URL=&quot;http://www.ubuntu.com/&quot;</span><br><span class="line">SUPPORT_URL=&quot;http://help.ubuntu.com/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;http://bugs.launchpad.net/ubuntu/&quot;</span><br><span class="line">VERSION_CODENAME=xenial</span><br><span class="line">UBUNTU_CODENAME=xenial</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/26/使用Qemu调试内核-host-aarch64/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/26/使用Qemu调试内核-host-aarch64/" itemprop="url">
                  使用Qemu调试内核(host=aarch64)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-26 20:50:42" itemprop="dateCreated datePublished" datetime="2016-03-26T20:50:42+08:00">2016-03-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/03/26/使用Qemu调试内核-host-aarch64/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/03/26/使用Qemu调试内核-host-aarch64/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在前一篇文章<a href="http://blog.csdn.net/jefbai/article/details/44901447" target="_blank" rel="noopener">http://blog.csdn.net/jefbai/article/details/44901447</a><br>已经介绍过主机为x86_64的情况下如何进行内核调试，但是如果主机换做AArch64呢？？方法类似～</p>
<p>1、编译qemu-system-aarch64</p>
<blockquote>
<p>git clone <a href="https://github.com/qemu/qemu" target="_blank" rel="noopener">https://github.com/qemu/qemu</a><br>./configure &amp;&amp; make -j8 </p>
</blockquote>
<p>随后将该目录添加到PATH变量并source ~/.bashrc</p>
<p>2、 下载并编译内核</p>
<blockquote>
<p>git clone <a href="https://git.fedorahosted.org/git/kernel-arm64.git" target="_blank" rel="noopener">https://git.fedorahosted.org/git/kernel-arm64.git</a><br>make -j8 Image </p>
</blockquote>
<p>3、安装gdb和gcc-c++<br>4、调试内核（本机，也可以通过网络）<br>qemu-system-aarch64 -machine virt -cpu cortex-a57 -machine       ↪ type=virt -nographic -smp 1 -m 2048 -kernel arch/arm64/boot/   ↪ Image  –append “console=ttyAMA0” -s -S<br>-s表示加入 gdb debug的功能，-S是让kernel停在第一行指令，不要往下跑。（可以写成脚本）<br>cd kernel-arm64<br>gdb ./vmlinux<br>target remote localhost:1234</p>
<p><img src="http://img.blog.csdn.net/20160326204802361" alt="run first scene"><br>5、此时可以使用gdb进行内核调试了<br>例如</p>
<blockquote>
<p>b start_kernel<br>c</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20160326205007112" alt="kernel"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/08/创建aarch64-docker镜像/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/08/创建aarch64-docker镜像/" itemprop="url">
                  创建aarch64 docker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-12-08 13:10:29" itemprop="dateCreated datePublished" datetime="2015-12-08T13:10:29+08:00">2015-12-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/12/08/创建aarch64-docker镜像/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/12/08/创建aarch64-docker镜像/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在官方的docker image中没有centos的image，所以我想自己做一个<br>参考资料：<br><a href="https://wiki.centos.org/zh/Cloud/Docker" target="_blank" rel="noopener">https://wiki.centos.org/zh/Cloud/Docker</a></p>
<h4 id="1-拷贝ami-creator代码库"><a href="#1-拷贝ami-creator代码库" class="headerlink" title="1. 拷贝ami-creator代码库"></a>1. 拷贝ami-creator代码库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> [https://github.com/katzj/ami-creator](https://github.com/katzj/ami-creator)</span><br></pre></td></tr></table></figure>
<h4 id="2-编译安装ami-creator"><a href="#2-编译安装ami-creator" class="headerlink" title="2. 编译安装ami-creator"></a>2. 编译安装ami-creator</h4><p>执行命令python setup.py build，发现提示以下错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#python setup.py build</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File &quot;setup.py&quot;, line 21, in &lt;module&gt;</span><br><span class="line">from ez_setup import use_setuptools</span><br><span class="line">ImportError: No module named ez_setup</span><br></pre></td></tr></table></figure>
<p>解决方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://bootstrap.pypa.io/ez_setup.py</span><br><span class="line">python ez_setup.py</span><br><span class="line">cp ez_setup.py /usr/lib/python2.7/site-packages/</span><br><span class="line"><span class="built_in">cd</span> ami-creator/</span><br><span class="line">python setup.py build</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure></p>
<p>此时运行ami-creator –help还是出现异常，提示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImportError: No module named imgcreate</span><br></pre></td></tr></table></figure></p>
<p>应该是缺少imgcreate文件？？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-imgcreate</span><br></pre></td></tr></table></figure></p>
<p>但是目前python-imgcreate不支持aarch64架构，所以需要添加patch，修改/usr/lib/python2.7/site-packages/imgcreate/live.py内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">elif arch.startswith(&apos;arm&apos;):</span><br><span class="line">  LiveImageCreator = LiveImageCreatorBase</span><br><span class="line">elif arch.startswith(&apos;aarch64&apos;):</span><br><span class="line">  LiveImageCreator = LiveImageCreatorBase</span><br><span class="line">else:</span><br><span class="line">  raise CreatorError(&quot;Architecture not supported!&quot;)</span><br></pre></td></tr></table></figure>
<p>此时ami-creator已经可以使用了，如下图所示：</p>
<p><a href="https://imgchr.com/i/PfXgGF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/08/19/PfXgGF.md.png" alt="PfXgGF.md.png"></a></p>
<h4 id="3-克隆代码库sig-cloud-instance-build，并编译出image"><a href="#3-克隆代码库sig-cloud-instance-build，并编译出image" class="headerlink" title="3. 克隆代码库sig-cloud-instance-build，并编译出image"></a>3. 克隆代码库sig-cloud-instance-build，并编译出image</h4><p><code>git clone [https://github.com/CentOS/sig-cloud-instance-build</code>，克隆制作docker image的ks文件，这个ks文件相比正常的ks文件，精简了体积，只保持系统到70M左右，果然很牛B<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ami-creater -c centos7-arm64.ks//如果顺利会生成centos7-arm64-xxxx.img</span><br><span class="line">img2tar.sh centos7-arm64-xxxx.img//会在/tmp目录下生成一个tar.bz2的文件</span><br><span class="line">docker import /tmp/centos7-arm64-xxxx.img.tar.bz2 jefby/centos-arm64</span><br></pre></td></tr></table></figure></p>
<h4 id="4-docker制作"><a href="#4-docker制作" class="headerlink" title="4. docker制作"></a>4. docker制作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libguestfs-tools</span><br><span class="line">docker import centos-7-arm64.img.tar.bz2 jefby/centos-arm64</span><br><span class="line">docker run -i -t jefby/centos-arm64 /bin/bash //获取到进入系统后的xxxx-id，或者使用docker ps -l方法找到image的xxxx-id</span><br><span class="line">docker commit -m &quot;init for centos arm64 images&quot; -a &quot;jefby&quot; xxxx-id//保存container的修改到image</span><br><span class="line">docker push jefby/centos-arm64//推送新的image</span><br><span class="line">由于v1.8.0和v1.8.1之间可能有一些API发生了改变，所以需要重新编译docker </span><br><span class="line">git remote add docker https://github.com/docker/docker/</span><br><span class="line">git pull docker</span><br><span class="line">git co v1.8.1</span><br><span class="line">cd docker</span><br><span class="line">./hack/make.sh dynbinary</span><br><span class="line">设置环境变量将心编译的docker放到前面去：</span><br><span class="line">export PATH=new-docker-path:$PATH</span><br><span class="line">docker --version查看版本</span><br></pre></td></tr></table></figure>
<p>继续 <code>docker push jefby/centos-arm64</code>将工作保存下来</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/30/ARM64从源码编译docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/30/ARM64从源码编译docker/" itemprop="url">
                  ARM64从源码编译docker（v1.9.1) 
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-11-30 20:41:11" itemprop="dateCreated datePublished" datetime="2015-11-30T20:41:11+08:00">2015-11-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/30/ARM64从源码编译docker/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/30/ARM64从源码编译docker/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在X86_64机器fedora系统下，不要使用官方编译的rpm包，交叉编译bootstrap会出现异常，使用源码编译的go.</p>
</blockquote>
<h3 id="1-编译X86-64的go-binary"><a href="#1-编译X86-64的go-binary" class="headerlink" title="1.编译X86_64的go binary"></a>1.编译X86_64的go binary</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">git clone https://github.com/golang/go</span><br><span class="line">git checkout go1.4.2</span><br><span class="line">cd src/</span><br><span class="line">./make.bash //先编译一个go x86_64</span><br><span class="line">mv /root/go /root/go1.4//因为go1.5beta代码固定了go路径</span><br></pre></td></tr></table></figure>
<h3 id="2-下载go1-5-1，使用go1-4为arm64交叉编译bootstrap，或者直接checkout-go1-5-1"><a href="#2-下载go1-5-1，使用go1-4为arm64交叉编译bootstrap，或者直接checkout-go1-5-1" class="headerlink" title="2.下载go1.5.1，使用go1.4为arm64交叉编译bootstrap，或者直接checkout go1.5.1"></a>2.下载go1.5.1，使用go1.4为arm64交叉编译bootstrap，或者直接checkout go1.5.1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd go/src/</span><br><span class="line">GOOS=linux GOARCH=arm64 ./bootstrap.bash</span><br></pre></td></tr></table></figure>
<h3 id="3-拷贝go-linux-arm64-bootstrap-tbz到Arm64机器上继续编译其他模块"><a href="#3-拷贝go-linux-arm64-bootstrap-tbz到Arm64机器上继续编译其他模块" class="headerlink" title="3. 拷贝go-linux-arm64-bootstrap.tbz到Arm64机器上继续编译其他模块"></a>3. 拷贝go-linux-arm64-bootstrap.tbz到Arm64机器上继续编译其他模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scp go-linux-arm64-bootstrap.tbz xxx //</span><br><span class="line">//下载go1.5.1代码</span><br><span class="line">git checkout go1.5.1</span><br><span class="line">cd go/src</span><br><span class="line">GOROOT=/path/to/go/bootstrap</span><br><span class="line">GOROOT_BOOTSTRAP=$GOROOT ./all.bash</span><br></pre></td></tr></table></figure>
<h3 id="4-下载docker源码并编译"><a href="#4-下载docker源码并编译" class="headerlink" title="4. 下载docker源码并编译"></a>4. 下载docker源码并编译</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jefby/docker.git</span><br><span class="line">git checkout jefby-v1.9.1 //找到最新的v1.9.1版本</span><br><span class="line">AUTO_GOPATH=1 ./hack/make.sh dynbinary //编译动态版本</span><br><span class="line">./hack/make.sh binary //静态版本，根据github docker社区的评论，似乎是用Redhat系列不能用静态版本的，因为默认使用了devicemapper，而不是ubuntu使用的aufs</span><br></pre></td></tr></table></figure>
<h3 id="5-需要安装glibc-static"><a href="#5-需要安装glibc-static" class="headerlink" title="5. 需要安装glibc-static"></a>5. 需要安装glibc-static</h3><p>在docker v1.9.1版本中，hack/make.sh dynbinary中依然依赖libc.a和libpthread.a库，所以需要安装glibc-static rpm包，提供这两个库~</p>
<h3 id="6-修改hack-make-sh增加set-x"><a href="#6-修改hack-make-sh增加set-x" class="headerlink" title="6. 修改hack/make.sh增加set -x"></a>6. 修改hack/make.sh增加set -x</h3><p>添加调试选项，进行debug，查看到底是什么地方出现错误</p>
<h3 id="7-安装必须的一些pkg"><a href="#7-安装必须的一些pkg" class="headerlink" title="7.安装必须的一些pkg"></a>7.安装必须的一些pkg</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y device-mapper-devel</span><br><span class="line">yum install -y btrfs-progs-devel</span><br></pre></td></tr></table></figure>
<h3 id="8-docker-pull-的时候提示错误Server-error-Status-0-while-fetching-image-layer"><a href="#8-docker-pull-的时候提示错误Server-error-Status-0-while-fetching-image-layer" class="headerlink" title="8.docker pull 的时候提示错误Server error: Status 0 while fetching image layer"></a>8.docker pull 的时候提示错误Server error: Status 0 while fetching image layer</h3><p>解决方法：<br>在/etc/hosts后面添加对docker网站的dns解析<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">162.242.195.84 index.docker.io</span><br><span class="line">162.242.195.84 registry-1.docker.io</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/06/Applied-Micro-Mustang-支持kvm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/06/Applied-Micro-Mustang-支持kvm/" itemprop="url">
                  Applied Micro Mustang 支持kvm 
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-11-06 20:16:39" itemprop="dateCreated datePublished" datetime="2015-11-06T20:16:39+08:00">2015-11-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/06/Applied-Micro-Mustang-支持kvm/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/11/06/Applied-Micro-Mustang-支持kvm/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在mustang机器上安装了Centos7，并升级内核到4.1.0-0.rc2</p>
<p><img src="http://img.blog.csdn.net/20151106195956322" alt="kernel-version"></p>
<p>但是dmesg发现并不支持kvm，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[    0.343796] kvm [1]: GICV size 0x2000 not a multiple of page size 0x10000</span><br><span class="line">[    0.343802] kvm [1]: error: no compatible GIC info found</span><br><span class="line">[    0.343909] kvm [1]: error initializing Hyp mode: -6</span><br></pre></td></tr></table></figure></p>
<p>在这里有相关的patch，<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1165290" target="_blank" rel="noopener">https://bugzilla.redhat.com/show_bug.cgi?id=1165290</a> ，但是打上补丁后虽然能够解决掉kvm的bug，但是又引入了新的问题，ethernet1和eth2识别不了，因为新的内核解析的时候需要增加对应的interrupt reg</p>
<p><img src="http://img.blog.csdn.net/20151106200426852" alt="patch"></p>
<p>按照如下修改后即可，好用的mustang.dts如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br></pre></td><td class="code"><pre><span class="line">/dts-v1/;</span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">	model = &quot;APM X-Gene Mustang board&quot;;</span><br><span class="line">	compatible = &quot;apm,mustang&quot;, &quot;apm,xgene-storm&quot;;</span><br><span class="line">	#address-cells = &lt;0x2&gt;;</span><br><span class="line">	#size-cells = &lt;0x2&gt;;</span><br><span class="line">	interrupt-parent = &lt;0x1&gt;;</span><br><span class="line"></span><br><span class="line">	pmu &#123;</span><br><span class="line">		interrupts = &lt;0x1 0xc 0xff04&gt;;</span><br><span class="line">		compatible = &quot;arm,armv8-pmuv3&quot;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	soc &#123;</span><br><span class="line">		compatible = &quot;simple-bus&quot;;</span><br><span class="line">		ranges;</span><br><span class="line">		#address-cells = &lt;0x2&gt;;</span><br><span class="line">		#size-cells = &lt;0x2&gt;;</span><br><span class="line"></span><br><span class="line">		sata@1a800000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1a800000 0x0 0x1000 0x0 0x1f230000 0x0 0x1000 0x0 0x1f23d000 0x0 0x1000 0x0 0x1f23e000 0x0 0x1000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x88 0x4&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-ahci&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		serial@1c020000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1c020000 0x0 0x1000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x4c 0x4&gt;;</span><br><span class="line">			reg-shift = &lt;0x2&gt;;</span><br><span class="line">			compatible = &quot;ns16550a&quot;;</span><br><span class="line">			clock-frequency = &lt;0x2faf080&gt;;</span><br><span class="line">			device_type = &quot;serial&quot;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			interrupt-parent = &lt;0x1&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		serial@1c021000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1c021000 0x0 0x1000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x4d 0x4&gt;;</span><br><span class="line">			reg-shift = &lt;0x2&gt;;</span><br><span class="line">			compatible = &quot;ns16550a&quot;;</span><br><span class="line">			clock-frequency = &lt;0x2faf080&gt;;</span><br><span class="line">			device_type = &quot;serial&quot;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">			interrupt-parent = &lt;0x1&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		serial@1c022000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1c022000 0x0 0x1000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x4e 0x4&gt;;</span><br><span class="line">			reg-shift = &lt;0x2&gt;;</span><br><span class="line">			compatible = &quot;ns16550a&quot;;</span><br><span class="line">			clock-frequency = &lt;0x2faf080&gt;;</span><br><span class="line">			device_type = &quot;serial&quot;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">			interrupt-parent = &lt;0x1&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		serial@1c023000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1c023000 0x0 0x1000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x4f 0x4&gt;;</span><br><span class="line">			reg-shift = &lt;0x2&gt;;</span><br><span class="line">			compatible = &quot;ns16550a&quot;;</span><br><span class="line">			clock-frequency = &lt;0x2faf080&gt;;</span><br><span class="line">			device_type = &quot;serial&quot;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">			interrupt-parent = &lt;0x1&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		pcie@1f500000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f500000 0x0 0x10000 0xa0 0xd0000000 0x0 0x200000&gt;;</span><br><span class="line">			reg-names = &quot;csr&quot;, &quot;cfg&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene-storm-pcie&quot;, &quot;apm,xgene-pcie&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			device_type = &quot;pci&quot;;</span><br><span class="line">			clocks = &lt;0x9 0x0&gt;;</span><br><span class="line">			#interrupt-cells = &lt;0x1&gt;;</span><br><span class="line">			dma-ranges = &lt;0x42000000 0x80 0x0 0x80 0x0 0x0 0x80000000 0x42000000 0x0 0x0 0x0 0x0 0x80 0x0&gt;;</span><br><span class="line">			ranges = &lt;0x1000000 0x0 0x0 0xa0 0x10000000 0x0 0x10000 0x2000000 0x0 0x80000000 0xa1 0x80000000 0x0 0x80000000&gt;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">			#address-cells = &lt;0x3&gt;;</span><br><span class="line">			interrupt-map = &lt;0x0 0x0 0x0 0x1 0x1 0x0 0xd4 0x1 0x0 0x0 0x0 0x2 0x1 0x0 0xd5 0x1 0x0 0x0 0x0 0x3 0x1 0x0 0xd6 0x1 0x0 0x0 0x0 0x4 0x1 0x0 0xd7 0x1&gt;;</span><br><span class="line">			interrupt-map-mask = &lt;0x0 0x0 0x0 0x7&gt;;</span><br><span class="line">			#size-cells = &lt;0x2&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		pcie@1f510000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f510000 0x0 0x10000 0xc0 0xd0000000 0x0 0x200000&gt;;</span><br><span class="line">			reg-names = &quot;csr&quot;, &quot;cfg&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene-storm-pcie&quot;, &quot;apm,xgene-pcie&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			device_type = &quot;pci&quot;;</span><br><span class="line">			clocks = &lt;0xa 0x0&gt;;</span><br><span class="line">			#interrupt-cells = &lt;0x1&gt;;</span><br><span class="line">			dma-ranges = &lt;0x42000000 0x80 0x0 0x80 0x0 0x0 0x80000000 0x42000000 0x0 0x0 0x0 0x0 0x80 0x0&gt;;</span><br><span class="line">			ranges = &lt;0x1000000 0x0 0x0 0xc0 0x10000000 0x0 0x10000 0x2000000 0x0 0x80000000 0xc1 0x80000000 0x0 0x80000000&gt;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">			#address-cells = &lt;0x3&gt;;</span><br><span class="line">			interrupt-map = &lt;0x0 0x0 0x0 0x1 0x1 0x0 0xda 0x1 0x0 0x0 0x0 0x2 0x1 0x0 0xdb 0x1 0x0 0x0 0x0 0x3 0x1 0x0 0xdc 0x1 0x0 0x0 0x0 0x4 0x1 0x0 0xdd 0x1&gt;;</span><br><span class="line">			interrupt-map-mask = &lt;0x0 0x0 0x0 0x7&gt;;</span><br><span class="line">			#size-cells = &lt;0x2&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		pcie@1f2b0000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f2b0000 0x0 0x10000 0xe0 0xd0000000 0x0 0x200000&gt;;</span><br><span class="line">			reg-names = &quot;csr&quot;, &quot;cfg&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene-storm-pcie&quot;, &quot;apm,xgene-pcie&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			device_type = &quot;pci&quot;;</span><br><span class="line">			clocks = &lt;0x6 0x0&gt;;</span><br><span class="line">			#interrupt-cells = &lt;0x1&gt;;</span><br><span class="line">			dma-ranges = &lt;0x42000000 0x80 0x0 0x80 0x0 0x0 0x80000000 0x42000000 0x0 0x0 0x0 0x0 0x80 0x0&gt;;</span><br><span class="line">			ranges = &lt;0x1000000 0x0 0x0 0xe0 0x10000000 0x0 0x10000 0x2000000 0x0 0x80000000 0xe1 0x80000000 0x0 0x80000000&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			#address-cells = &lt;0x3&gt;;</span><br><span class="line">			interrupt-map = &lt;0x0 0x0 0x0 0x1 0x1 0x0 0xc2 0x1 0x0 0x0 0x0 0x2 0x1 0x0 0xc3 0x1 0x0 0x0 0x0 0x3 0x1 0x0 0xc4 0x1 0x0 0x0 0x0 0x4 0x1 0x0 0xc5 0x1&gt;;</span><br><span class="line">			interrupt-map-mask = &lt;0x0 0x0 0x0 0x7&gt;;</span><br><span class="line">			#size-cells = &lt;0x2&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		pcie@1f2c0000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f2c0000 0x0 0x10000 0xd0 0xd0000000 0x0 0x200000&gt;;</span><br><span class="line">			reg-names = &quot;csr&quot;, &quot;cfg&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene-storm-pcie&quot;, &quot;apm,xgene-pcie&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			device_type = &quot;pci&quot;;</span><br><span class="line">			clocks = &lt;0x7 0x0&gt;;</span><br><span class="line">			#interrupt-cells = &lt;0x1&gt;;</span><br><span class="line">			dma-ranges = &lt;0x42000000 0x80 0x0 0x80 0x0 0x0 0x80000000 0x42000000 0x0 0x0 0x0 0x0 0x80 0x0&gt;;</span><br><span class="line">			ranges = &lt;0x1000000 0x0 0x0 0xd0 0x10000000 0x0 0x10000 0x2000000 0x0 0x80000000 0xd1 0x80000000 0x0 0x80000000&gt;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">			#address-cells = &lt;0x3&gt;;</span><br><span class="line">			interrupt-map = &lt;0x0 0x0 0x0 0x1 0x1 0x0 0xc8 0x1 0x0 0x0 0x0 0x2 0x1 0x0 0xc9 0x1 0x0 0x0 0x0 0x3 0x1 0x0 0xca 0x1 0x0 0x0 0x0 0x4 0x1 0x0 0xcb 0x1&gt;;</span><br><span class="line">			interrupt-map-mask = &lt;0x0 0x0 0x0 0x7&gt;;</span><br><span class="line">			#size-cells = &lt;0x2&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		pcie@1f2d0000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f2d0000 0x0 0x10000 0x90 0xd0000000 0x0 0x200000&gt;;</span><br><span class="line">			reg-names = &quot;csr&quot;, &quot;cfg&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene-storm-pcie&quot;, &quot;apm,xgene-pcie&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			device_type = &quot;pci&quot;;</span><br><span class="line">			clocks = &lt;0x8 0x0&gt;;</span><br><span class="line">			#interrupt-cells = &lt;0x1&gt;;</span><br><span class="line">			dma-ranges = &lt;0x42000000 0x80 0x0 0x80 0x0 0x0 0x80000000 0x42000000 0x0 0x0 0x0 0x0 0x80 0x0&gt;;</span><br><span class="line">			ranges = &lt;0x1000000 0x0 0x0 0x90 0x10000000 0x0 0x10000 0x2000000 0x0 0x80000000 0x91 0x80000000 0x0 0x80000000&gt;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">			#address-cells = &lt;0x3&gt;;</span><br><span class="line">			interrupt-map = &lt;0x0 0x0 0x0 0x1 0x1 0x0 0xce 0x1 0x0 0x0 0x0 0x2 0x1 0x0 0xcf 0x1 0x0 0x0 0x0 0x3 0x1 0x0 0xd0 0x1 0x0 0x0 0x0 0x4 0x1 0x0 0xd1 0x1&gt;;</span><br><span class="line">			interrupt-map-mask = &lt;0x0 0x0 0x0 0x7&gt;;</span><br><span class="line">			#size-cells = &lt;0x2&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		ethernet_old@17020000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x17020000 0x0 0x30 0x0 0x17020000 0x0 0x10000 0x0 0x17020000 0x0 0x20&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x38 0x4 0x0 0x39 0x4 0x0 0x3a 0x4&gt;;</span><br><span class="line">			#clock-cells = &lt;0x1&gt;;</span><br><span class="line">			devid = &lt;0x8&gt;;</span><br><span class="line">			phyid = &lt;0x3&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-enet-old&quot;;</span><br><span class="line">			local-mac-address = [00 01 73 02 0b 73];</span><br><span class="line">			slave-name = &quot;RGMII&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			phy-mode = &quot;rgmii&quot;;</span><br><span class="line">			clocks = &lt;0x15 0x0&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			max-frame-size = &lt;0x233a&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		dwusb@19000000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x19000000 0x0 0x100000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x89 0x4&gt;;</span><br><span class="line">			compatible = &quot;xhci-platform&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		phy@1f21a000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f21a000 0x0 0x100&gt;;</span><br><span class="line">			apm,tx-eye-tuning = &lt;0x2 0xa 0xa 0x2 0xa 0xa&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-phy&quot;;</span><br><span class="line">			#phy-cells = &lt;0x1&gt;;</span><br><span class="line">			clocks = &lt;0xb 0x0&gt;;</span><br><span class="line">			apm,tx-boost-gain = &lt;0x2 0x3 0x3 0x2 0x3 0x3&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			phandle = &lt;0xf&gt;;</span><br><span class="line">			linux,phandle = &lt;0xf&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		phy@1f22a000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f22a000 0x0 0x100&gt;;</span><br><span class="line">			apm,tx-eye-tuning = &lt;0x1 0xa 0xa 0x2 0xa 0xa&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-phy&quot;;</span><br><span class="line">			#phy-cells = &lt;0x1&gt;;</span><br><span class="line">			apm,tx-boost-gain = &lt;0x1e 0x1e 0x1e 0x1e 0x1e 0x1e&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			phandle = &lt;0x11&gt;;</span><br><span class="line">			linux,phandle = &lt;0x11&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		phy@1f23a000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f23a000 0x0 0x100&gt;;</span><br><span class="line">			apm,tx-eye-tuning = &lt;0x2 0xa 0xa 0x2 0xa 0xa&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-phy&quot;;</span><br><span class="line">			#phy-cells = &lt;0x1&gt;;</span><br><span class="line">			apm,tx-boost-gain = &lt;0x1f 0x1f 0x1f 0x1f 0x1f 0x1f&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			phandle = &lt;0x13&gt;;</span><br><span class="line">			linux,phandle = &lt;0x13&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		system-clk-controller@17000000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x17000000 0x0 0x400&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-scu&quot;, &quot;syscon&quot;;</span><br><span class="line">			phandle = &lt;0x16&gt;;</span><br><span class="line">			linux,phandle = &lt;0x16&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		dwusb@19800000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x19800000 0x0 0x100000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x8a 0x4&gt;;</span><br><span class="line">			compatible = &quot;xhci-platform&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		clocks &#123;</span><br><span class="line">			ranges;</span><br><span class="line">			#address-cells = &lt;0x2&gt;;</span><br><span class="line">			#size-cells = &lt;0x2&gt;;</span><br><span class="line"></span><br><span class="line">			pcie1clk@1f2cc000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f2cc000 0x0 0x1000&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;pcie1clk&quot;;</span><br><span class="line">				status = &quot;disabled&quot;;</span><br><span class="line">				phandle = &lt;0x7&gt;;</span><br><span class="line">				linux,phandle = &lt;0x7&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			pcie2clk@1f2dc000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f2dc000 0x0 0x1000&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;pcie2clk&quot;;</span><br><span class="line">				status = &quot;disabled&quot;;</span><br><span class="line">				phandle = &lt;0x8&gt;;</span><br><span class="line">				linux,phandle = &lt;0x8&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			xge0clk@1f61c000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f61c000 0x0 0x1000&gt;;</span><br><span class="line">				csr-mask = &lt;0x3&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;xge0clk&quot;;</span><br><span class="line">				phandle = &lt;0x19&gt;;</span><br><span class="line">				linux,phandle = &lt;0x19&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			sataphy1clk@1f21c000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f21c000 0x0 0x1000&gt;;</span><br><span class="line">				csr-offset = &lt;0x4&gt;;</span><br><span class="line">				csr-mask = &lt;0x0&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				enable-offset = &lt;0x0&gt;;</span><br><span class="line">				enable-mask = &lt;0x6&gt;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;sataphy1clk&quot;;</span><br><span class="line">				status = &quot;disabled&quot;;</span><br><span class="line">				phandle = &lt;0xb&gt;;</span><br><span class="line">				linux,phandle = &lt;0xb&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			socplldiv2 &#123;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				compatible = &quot;fixed-factor-clock&quot;;</span><br><span class="line">				clock-names = &quot;socplldiv2&quot;;</span><br><span class="line">				clocks = &lt;0x3 0x0&gt;;</span><br><span class="line">				clock-div = &lt;0x2&gt;;</span><br><span class="line">				clock-output-names = &quot;socplldiv2&quot;;</span><br><span class="line">				phandle = &lt;0x4&gt;;</span><br><span class="line">				clock-mult = &lt;0x1&gt;;</span><br><span class="line">				linux,phandle = &lt;0x4&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			rngpkaclk@17000000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x17000000 0x0 0x2000&gt;;</span><br><span class="line">				csr-offset = &lt;0xc&gt;;</span><br><span class="line">				csr-mask = &lt;0x10&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				enable-offset = &lt;0x10&gt;;</span><br><span class="line">				enable-mask = &lt;0x10&gt;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;rngpkaclk&quot;;</span><br><span class="line">				phandle = &lt;0x1a&gt;;</span><br><span class="line">				linux,phandle = &lt;0x1a&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			sge0clk@1f21c000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f21c000 0x0 0x1000&gt;;</span><br><span class="line">				csr-mask = &lt;0x3&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;sge0clk&quot;;</span><br><span class="line">				phandle = &lt;0x18&gt;;</span><br><span class="line">				linux,phandle = &lt;0x18&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			pcie3clk@1f50c000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f50c000 0x0 0x1000&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;pcie3clk&quot;;</span><br><span class="line">				status = &quot;disabled&quot;;</span><br><span class="line">				phandle = &lt;0x9&gt;;</span><br><span class="line">				linux,phandle = &lt;0x9&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			ethclk &#123;</span><br><span class="line">				reg = &lt;0x0 0x17000000 0x0 0x1000&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;div-reg&quot;;</span><br><span class="line">				divider-shift = &lt;0x0&gt;;</span><br><span class="line">				divider-width = &lt;0x9&gt;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clock-names = &quot;ethclk&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;ethclk&quot;;</span><br><span class="line">				divider-offset = &lt;0x238&gt;;</span><br><span class="line">				phandle = &lt;0x5&gt;;</span><br><span class="line">				linux,phandle = &lt;0x5&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			pcppll@17000100 &#123;</span><br><span class="line">				reg = &lt;0x0 0x17000100 0x0 0x1000&gt;;</span><br><span class="line">				type = &lt;0x0&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				compatible = &quot;apm,xgene-pcppll-clock&quot;;</span><br><span class="line">				clock-names = &quot;pcppll&quot;;</span><br><span class="line">				clocks = &lt;0x2 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;pcppll&quot;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			qmlclk &#123;</span><br><span class="line">				reg = &lt;0x0 0x1703c000 0x0 0x1000&gt;;</span><br><span class="line">				csr-offset = &lt;0x0&gt;;</span><br><span class="line">				csr-mask = &lt;0x3&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clock-names = &quot;qmlclk&quot;;</span><br><span class="line">				enable-offset = &lt;0x8&gt;;</span><br><span class="line">				enable-mask = &lt;0x3&gt;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;qmlclk&quot;;</span><br><span class="line">				status = &quot;ok&quot;;</span><br><span class="line">				phandle = &lt;0x14&gt;;</span><br><span class="line">				linux,phandle = &lt;0x14&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			refclk &#123;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				compatible = &quot;fixed-clock&quot;;</span><br><span class="line">				clock-frequency = &lt;0x5f5e100&gt;;</span><br><span class="line">				clock-output-names = &quot;refclk&quot;;</span><br><span class="line">				phandle = &lt;0x2&gt;;</span><br><span class="line">				linux,phandle = &lt;0x2&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			pcie4clk@1f51c000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f51c000 0x0 0x1000&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;pcie4clk&quot;;</span><br><span class="line">				status = &quot;disabled&quot;;</span><br><span class="line">				phandle = &lt;0xa&gt;;</span><br><span class="line">				linux,phandle = &lt;0xa&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			pcie0clk@1f2bc000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f2bc000 0x0 0x1000&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;pcie0clk&quot;;</span><br><span class="line">				status = &quot;ok&quot;;</span><br><span class="line">				phandle = &lt;0x6&gt;;</span><br><span class="line">				linux,phandle = &lt;0x6&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			socpll@17000120 &#123;</span><br><span class="line">				reg = &lt;0x0 0x17000120 0x0 0x1000&gt;;</span><br><span class="line">				type = &lt;0x1&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				compatible = &quot;apm,xgene-socpll-clock&quot;;</span><br><span class="line">				clock-names = &quot;socpll&quot;;</span><br><span class="line">				clocks = &lt;0x2 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;socpll&quot;;</span><br><span class="line">				phandle = &lt;0x3&gt;;</span><br><span class="line">				linux,phandle = &lt;0x3&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			sata01clk@1f21c000 &#123;</span><br><span class="line">				reg = &lt;0x0 0x1f21c000 0x0 0x1000&gt;;</span><br><span class="line">				csr-offset = &lt;0x4&gt;;</span><br><span class="line">				csr-mask = &lt;0x5&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				enable-offset = &lt;0x0&gt;;</span><br><span class="line">				enable-mask = &lt;0x39&gt;;</span><br><span class="line">				clocks = &lt;0x4 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;sata01clk&quot;;</span><br><span class="line">				phandle = &lt;0xe&gt;;</span><br><span class="line">				linux,phandle = &lt;0xe&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			menetclk &#123;</span><br><span class="line">				reg = &lt;0x0 0x1702c000 0x0 0x1000&gt;;</span><br><span class="line">				#clock-cells = &lt;0x1&gt;;</span><br><span class="line">				reg-names = &quot;csr-reg&quot;;</span><br><span class="line">				compatible = &quot;apm,xgene-device-clock&quot;;</span><br><span class="line">				clock-names = &quot;menetclk&quot;;</span><br><span class="line">				clocks = &lt;0x5 0x0&gt;;</span><br><span class="line">				clock-output-names = &quot;menetclk&quot;;</span><br><span class="line">				phandle = &lt;0x15&gt;;</span><br><span class="line">				linux,phandle = &lt;0x15&gt;;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		rng@10520000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x10520000 0x0 0x100&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x41 0x4&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-rng&quot;;</span><br><span class="line">			clocks = &lt;0x1a 0x0&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		qmtm@17030000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x17030000 0x0 0x10000 0x0 0x10000000 0x0 0x400000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x40 0x4 0x0 0x3c 0x4&gt;;</span><br><span class="line">			#clock-cells = &lt;0x1&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-qmtm-lite&quot;;</span><br><span class="line">			slave-name = &quot;CPU_QMTM3&quot;;</span><br><span class="line">			clocks = &lt;0x14 0x0&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		oldsata@1a000000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1a000000 0x0 0x1000 0x0 0x1f210000 0x0 0x10000&gt;;</span><br><span class="line">			phys = &lt;0xf 0x0&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x86 0x4&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-ahci-sgmii&quot;;</span><br><span class="line">			phy-names = &quot;sata-6g&quot;;</span><br><span class="line">			clocks = &lt;0xe 0x0&gt;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		reboot@17000014 &#123;</span><br><span class="line">			mask = &lt;0x1&gt;;</span><br><span class="line">			compatible = &quot;syscon-reboot&quot;;</span><br><span class="line">			offset = &lt;0x14&gt;;</span><br><span class="line">			regmap = &lt;0x16&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		oldsata@1a400000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1a400000 0x0 0x1000 0x0 0x1f220000 0x0 0x10000&gt;;</span><br><span class="line">			phys = &lt;0x11 0x0&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x87 0x4&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-ahci-sgmii&quot;;</span><br><span class="line">			phy-names = &quot;sata-6g&quot;;</span><br><span class="line">			clocks = &lt;0x10 0x0&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		oldsata@1a800000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1a800000 0x0 0x1000 0x0 0x1f230000 0x0 0x10000&gt;;</span><br><span class="line">			phys = &lt;0x13 0x0&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x88 0x4&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-ahci-pcie&quot;;</span><br><span class="line">			phy-names = &quot;sata-6g&quot;;</span><br><span class="line">			clocks = &lt;0x12 0x0&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		ethernet@17020000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x17020000 0x0 0xd100 0x0 0x17030000 0x0 0xc300 0x0 0x10000000 0x0 0x200&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x3c 0x4&gt;;</span><br><span class="line">			phy-handle = &lt;0x17&gt;;</span><br><span class="line">			reg-names = &quot;enet_csr&quot;, &quot;ring_csr&quot;, &quot;ring_cmd&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene-enet&quot;;</span><br><span class="line">			local-mac-address = [00 01 73 02 0b 73];</span><br><span class="line">			dma-coherent;</span><br><span class="line">			clocks = &lt;0x15 0x0&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			phy-connection-type = &quot;rgmii&quot;;</span><br><span class="line"></span><br><span class="line">			mdio &#123;</span><br><span class="line">				compatible = &quot;apm,xgene-mdio&quot;;</span><br><span class="line">				#address-cells = &lt;0x1&gt;;</span><br><span class="line">				#size-cells = &lt;0x0&gt;;</span><br><span class="line"></span><br><span class="line">				menetphy@3 &#123;</span><br><span class="line">					reg = &lt;0x3&gt;;</span><br><span class="line">					compatible = &quot;ethernet-phy-id001c.c915&quot;;</span><br><span class="line">					phandle = &lt;0x17&gt;;</span><br><span class="line">					linux,phandle = &lt;0x17&gt;;</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		ethernet@1f210000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f210000 0x0 0xd100 0x0 0x1f200000 0x0 0xc300 0x0 0x1b000000 0x0 0x200&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0xa0 0x4 0x0 0xa1 0x4&gt;;</span><br><span class="line">			reg-names = &quot;enet_csr&quot;, &quot;ring_csr&quot;, &quot;ring_cmd&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene1-sgenet&quot;;</span><br><span class="line">			local-mac-address = [00 00 00 00 00 00];</span><br><span class="line">			dma-coherent;</span><br><span class="line">			clocks = &lt;0x18 0x0&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			phy-connection-type = &quot;sgmii&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		ethernet@1f610000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1f610000 0x0 0xd100 0x0 0x1f600000 0x0 0xc300 0x0 0x18000000 0x0 0x200&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x60 0x4 0x0 0x61 0x4&gt;;</span><br><span class="line">			reg-names = &quot;enet_csr&quot;, &quot;ring_csr&quot;, &quot;ring_cmd&quot;;</span><br><span class="line">			compatible = &quot;apm,xgene1-xgenet&quot;;</span><br><span class="line">			local-mac-address = [00 00 00 00 00 00];</span><br><span class="line">			dma-coherent;</span><br><span class="line">			clocks = &lt;0x19 0x0&gt;;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">			phy-connection-type = &quot;xgmii&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		sata@1a000000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1a000000 0x0 0x1000 0x0 0x1f210000 0x0 0x1000 0x0 0x1f21d000 0x0 0x1000 0x0 0x1f21e000 0x0 0x1000 0x0 0x1f217000 0x0 0x1000&gt;;</span><br><span class="line">			phys = &lt;0xf 0x0&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x86 0x4&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-ahci&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			phy-names = &quot;sata-phy&quot;;</span><br><span class="line">			clocks = &lt;0xe 0x0&gt;;</span><br><span class="line">			status = &quot;disabled&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		sata@1a400000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1a400000 0x0 0x1000 0x0 0x1f220000 0x0 0x1000 0x0 0x1f22d000 0x0 0x1000 0x0 0x1f22e000 0x0 0x1000 0x0 0x1f227000 0x0 0x1000&gt;;</span><br><span class="line">			interrupts = &lt;0x0 0x87 0x4&gt;;</span><br><span class="line">			compatible = &quot;apm,xgene-ahci&quot;;</span><br><span class="line">			dma-coherent;</span><br><span class="line">			status = &quot;ok&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	cpus &#123;</span><br><span class="line">		#address-cells = &lt;0x2&gt;;</span><br><span class="line">		#size-cells = &lt;0x0&gt;;</span><br><span class="line"></span><br><span class="line">		cpu@000 &#123;</span><br><span class="line">			reg = &lt;0x0 0x0&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0x8008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		cpu@001 &#123;</span><br><span class="line">			reg = &lt;0x0 0x1&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0x9008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		cpu@100 &#123;</span><br><span class="line">			reg = &lt;0x0 0x100&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0xa008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		cpu@101 &#123;</span><br><span class="line">			reg = &lt;0x0 0x101&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0xb008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		cpu@200 &#123;</span><br><span class="line">			reg = &lt;0x0 0x200&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0xc008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		cpu@201 &#123;</span><br><span class="line">			reg = &lt;0x0 0x201&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0xd008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		cpu@300 &#123;</span><br><span class="line">			reg = &lt;0x0 0x300&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0xe008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		cpu@301 &#123;</span><br><span class="line">			reg = &lt;0x0 0x301&gt;;</span><br><span class="line">			compatible = &quot;apm,potenza&quot;, &quot;arm,armv8&quot;;</span><br><span class="line">			cpu-release-addr = &lt;0x40 0xf008&gt;;</span><br><span class="line">			enable-method = &quot;spin-table&quot;;</span><br><span class="line">			device_type = &quot;cpu&quot;;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	timer &#123;</span><br><span class="line">		interrupts = &lt;0x1 0x0 0xff01 0x1 0xd 0xff01 0x1 0xe 0xff01 0x1 0xf 0xff01&gt;;</span><br><span class="line">		compatible = &quot;arm,armv8-timer&quot;;</span><br><span class="line">		clock-frequency = &lt;0x2faf080&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	aliases &#123;</span><br><span class="line">		ethernet0 = &quot;/soc/ethernet@17020000&quot;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	interrupt-controller@78010000 &#123;</span><br><span class="line">		reg = &lt;0x0 0x78090000 0x0 0x10000 0x0 0x780a0000 0x0 0x20000 0x0 0x780c0000 0x0 0x10000 0x0 0x780e0000 0x0 0x20000&gt;;</span><br><span class="line">		interrupts = &lt;0x1 0x9 0xf04&gt;;</span><br><span class="line">		compatible = &quot;arm,cortex-a15-gic&quot;;</span><br><span class="line">		#interrupt-cells = &lt;0x3&gt;;</span><br><span class="line">		phandle = &lt;0x1&gt;;</span><br><span class="line">		interrupt-controller;</span><br><span class="line">		linux,phandle = &lt;0x1&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y dtc</span><br><span class="line">dtc -I dts mustang.dts -O dtb -o /boot/mustang.dtb</span><br></pre></td></tr></table></figure>
<p>随后修改/boot/efi/EFI/centos/grub.cfg中修改第一个entry，添加</p>
<p>devicetree /mustang.dtb</p>
<p>并重启即可~</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/29/AArch64简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jefby">
      <meta itemprop="description" content="记录点点滴滴">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jefby的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/29/AArch64简介/" itemprop="url">
                  AArch64简介
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2015-08-29 10:10:44" itemprop="dateCreated datePublished" datetime="2015-08-29T10:10:44+08:00">2015-08-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-08-20 13:41:06" itemprop="dateModified" datetime="2018-08-20T13:41:06+08:00">2018-08-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/aarch64/" itemprop="url" rel="index"><span itemprop="name">aarch64</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/29/AArch64简介/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/29/AArch64简介/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="about-aarch64"><a href="#about-aarch64" class="headerlink" title="about aarch64"></a>about aarch64</h1><ol>
<li>Focus on high performance </li>
<li>Exception levels instead of different modes</li>
<li>virtualisation support built-in</li>
<li>32 bit fixed length instruction </li>
<li>more registers</li>
<li>divide instruction</li>
<li>compare &amp; jump instruction</li>
<li>support for aarch32</li>
</ol>
<h2 id="difference-towards-aarch32"><a href="#difference-towards-aarch32" class="headerlink" title="difference towards aarch32"></a>difference towards aarch32</h2><ol>
<li>no thumb mode</li>
<li>only a handful conditionally executing instruction</li>
<li>no more coprocessor</li>
<li>beware PC relative addressing doesn’t have an offset anymore</li>
<li>31 general purpose registers.1 special purpose</li>
<li>no store/load multiple registers(only pairs)</li>
</ol>
<h2 id="aarch64-registers"><a href="#aarch64-registers" class="headerlink" title="aarch64 registers"></a>aarch64 registers</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">registers	special	description</span><br><span class="line">SP/ZR				Stack pointor/Zero register</span><br><span class="line">30			LR		Link register</span><br><span class="line">29			FP		Frame pointer</span><br><span class="line">19~28				stored/restored by callee</span><br><span class="line">18					platforem specific register</span><br><span class="line">17					inter procedure call 1</span><br><span class="line">16					inter procedure call 2</span><br><span class="line">9~15				scratch registers</span><br><span class="line">8					indirect result(pointer to sturct)</span><br><span class="line">0~7					parameters &amp; results</span><br></pre></td></tr></table></figure>
<h3 id="registers-can-be-accessed-as-32-64-bit"><a href="#registers-can-be-accessed-as-32-64-bit" class="headerlink" title="registers can be accessed as 32/64 bit"></a>registers can be accessed as 32/64 bit</h3><p>X0~30 for 64 bit<br>W0~30 for 32 bit<br>Also available<br>V0~31,SIMD floating point registers</p>
<h3 id="Modes-AArch32"><a href="#Modes-AArch32" class="headerlink" title="Modes AArch32"></a>Modes AArch32</h3><p>User        Application<br>FIQ            Fast Interrupt<br>IRQ            Interrupt<br>Supervisor     Operating System<br>Abort         Prefetch abort of instructiion/data<br>Undefined    After undefined instruction<br>System        Privileged user mode (for OS functions)<br>Monitor        On TrustZone Platforms</p>
<h3 id="Modes-on-Aarch64"><a href="#Modes-on-Aarch64" class="headerlink" title="Modes on Aarch64"></a>Modes on Aarch64</h3><p>EL0            Unprivileged,applications(with task protection,etc)<br>EL1            Operating system,kernel,etc<br>EL2            Hypervisor(for virtualisation)<br>EL3            Secure monitor(for switching to/from secure state)</p>
<blockquote>
<p>svc,hvc,smc指令切换，对EL1~3有三种不同的中断向量，客户端可以生产virtual exceptions</p>
</blockquote>
<p><em>CP15 is no more</em></p>
<blockquote>
<p>Cache,address and TLB management now have dedicated instructions</p>
</blockquote>
<blockquote>
<p>Memory management</p>
</blockquote>
<blockquote>
<p>Execpt for EL0,all exception levels have their own memory translation </p>
</blockquote>
<blockquote>
<p>context(EL0 is managed by EL1)</p>
</blockquote>
<blockquote>
<p>This means up to 3 stage translation depending on the context</p>
</blockquote>
<h2 id="UEFI-amp-ACPI"><a href="#UEFI-amp-ACPI" class="headerlink" title="UEFI&amp;ACPI"></a>UEFI&amp;ACPI</h2><p><a href="http://www.uefi.org/sites/default/files/resources/S4_BldgARMServers_UEFILinuxCon_FINAL_Aug.%2021.pdf" target="_blank" rel="noopener">http://www.uefi.org/sites/default/files/resources/S4_BldgARMServers_UEFILinuxCon_FINAL_Aug.%2021.pdf</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">jefby</p>
              <p class="site-description motion-element" itemprop="description">记录点点滴滴</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/jefby/" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/jefby_plus" target="_blank" title="Twitter"><i class="fa fa-fw fa-Twitter"></i>Twitter</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jefby</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.4.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  

  
    <script id="dsq-count-scr" src="https://jefby-github-io.disqus.com/count.js" async></script>
  

  












  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
